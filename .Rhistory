library(tidyverse)
library(readxl)
raw_df <- read_excel("Export_GTF_IEA_202205_edited.xls")
View(raw_df)
library(reshape)
install.packages("reshape")
library(reshape)
str(raw_df)
raw_df[duplicated(raw_df$Borderpoint)]
unp_df <- melt(raw_df, id = c("Borderpoint", "Entry", "Exit"))
unp_df <- melt(raw_df, id = c("Borderpoint"))
library(data.table)
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
View(unp_df)
colnames(unp_df)[5] <- "gtf_Mcm"
View(unp_df)
library(lubridate)
unp_df <- unp_df %>%
mutate(Month = as_date(Month)) %>%
mutate(Month = my(Month))
star(unp_df)
str(unp_df)
unp_df <- unp_df %>%
transform(Month = as.numeric(Month)) %>%
mutate(Month = as_date(Month)) %>%
mutate(Month = my(Month))
unp_df <- unp_df %>%
transform(Month = as.numeric(Month))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
unp_df <- unp_df %>%
transform(Month = as.numeric(Month))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
unp_df <- unp_df %>%
mutate(Month = my(Month))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
cols(unp_df)
str(unp_df)
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month)) %>%
mutate(Month = my(Month))
#unpivot months
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month)))
str(unp_df)
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month)))
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_datetime(Month))
raw_df <- read_excel("Export_GTF_IEA_202205_edited.xls")
#unpivot months
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month / 1000))) %>%
mutate(Month = as_date(Month)) %>%
mutate(Month = my(Month))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month/1000))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month/100))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month)))
str(unp_df)
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin(date("01/01/1990"))))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("01/01/1990")))
#unpivot months
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("01/01/1900")))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("01/01/1900")))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date(01/01/1900)))
#unpivot months
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("01/01/1900")))
date("01/01/1990")
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("1900/01/01")))
#unpivot months
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("1900/01/01"))) %>%
mutate(Month = my(Month))
#unpivot months
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("1900/01/01")))
ym("2008/10/03")
library(zoo)
install.packages(zoo)
install.packages("zoo")
library(zoo)
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("1900/01/01"))) %>%
mutate(Month = as.yearmon(Month))
str(unp_df)
unp_df[is.na(unp_df)] <- 0
unp_df[unp_df$gtf_Mcm == "N/A"] <- 0
mutate(unp_df$gtf_Mcm = as.numeric(unp_df$gtf_Mcm))
mutate(unp_df, unp_df$gtf_Mcm = as.numeric(unp_df$gtf_Mcm))
#unpivot months
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("1900/01/01"))) %>%
mutate(Month = as.yearmon(Month))
#change NA values to 0 and make gtf column numeric
unp_df[unp_df$gtf_Mcm == "N/A"] <- 0
unp_df <- unp_df %>%
mutate(gtf_Mcm = as.numeric(gtf_Mcm))
str(unp_df)
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("1900/01/01"))) %>%
mutate(Month = as.yearmon(Month))
#change NA values to 0, make gtf column numeric and change colnames to lowercase
unp_df[unp_df$gtf_Mcm == "N/A"] <- 0
unp_df <- unp_df %>%
mutate(gtf_Mcm = as.numeric(gtf_Mcm)) %>%
tolower(names(unp_df))
#unpivot months
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("1900/01/01"))) %>%
mutate(Month = as.yearmon(Month))
#change NA values to 0, make gtf column numeric and change colnames to lowercase
unp_df[unp_df$gtf_Mcm == "N/A"] <- 0
unp_df <- unp_df %>%
mutate(gtf_Mcm = as.numeric(gtf_Mcm)) %>%
tolower()
#unpivot months
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("1900/01/01"))) %>%
mutate(Month = as.yearmon(Month))
#change NA values to 0, make gtf column numeric and change colnames to lowercase
unp_df[unp_df$gtf_Mcm == "N/A"] <- 0
unp_df <- unp_df %>%
mutate(gtf_Mcm = as.numeric(gtf_Mcm))
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("1900/01/01"))) %>%
mutate(Month = as.yearmon(Month))
#change NA values to 0, make gtf column numeric
unp_df[unp_df$gtf_Mcm == "N/A"] <- 0
unp_df <- unp_df %>%
mutate(gtf_Mcm = as.numeric(gtf_Mcm))
#change colnames to lowercase
unp_df <- tolower(unp_df)
#unpivot months
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("1900/01/01"))) %>%
mutate(Month = as.yearmon(Month))
#change NA values to 0, make gtf column numeric
unp_df[unp_df$gtf_Mcm == "N/A"] <- 0
unp_df <- unp_df %>%
mutate(gtf_Mcm = as.numeric(gtf_Mcm))
#change colnames to lowercase
names(unp_df) <- tolower(names(unp_df))
View(unp_df)
unp_df <- melt(setDT(raw_df), id.vars = c("Borderpoint", "Exit", "Entry"), variable.name = "Month")
#clean col names
colnames(unp_df)[5] <- "gtf_Mcm"
#convert month column to mm-yyyy
unp_df <- unp_df %>%
transform(Month = as.numeric(as.character(Month))) %>%
mutate(Month = as_date(Month, origin = date("1900/01/01"))) %>%
mutate(Month = as.yearmon(Month))
#change NA values to 0, make gtf column numeric
unp_df[unp_df$gtf_Mcm == "N/A"] <- 0
unp_df <- unp_df %>%
mutate(gtf_Mcm = as.numeric(gtf_Mcm))
#change colnames to lowercase
names(unp_df) <- tolower(names(unp_df))
#export to csv
write_csv(unp_df, "gas_exports_data_cleaned.csv")
library(tidyverse)
gas_data <- read_csv("gas_exports_data_cleaned.csv")
View(gas_data)
library(tidyverse)
top_exp <- gas_data %>%
select(exit, month, gtf_mcm) %>%
group_by(exit)
View(top_exp)
top_exp <- gas_data %>%
select(exit, month, gtf_mcm) %>%
group_by(exit) %>%
summarise(export = sum(gtf_mcm))
top_exp <- gas_data %>%
select(exit, month, gtf_mcm) %>%
group_by(exit, month) %>%
summarise(export = sum(gtf_mcm))
